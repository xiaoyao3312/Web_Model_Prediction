C:\Users\user\Desktop\Web_Model_Prediction\templates\Churn_Bank.html
{% extends "base_Churn.html" %}

{% block title %}銀行客戶流失預測 - 客戶流失預測平台{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/churn_bank.css') }}">
{% endblock %}

{% block content %}
<div id="churn_bank" class="page-content">
    <h1 class="page-title">客戶流失_銀行MODEL - 預測分析 (含 AI 解釋)</h1>
    
    <div class="main-panel-grid">
        
        <div class="api-key-panel card">
            <h2 class="card-title">🔑 Gemini API 啟用</h2>
            <div class="api-key-container">
                                <input type="password" id="apiKey" placeholder="請輸入 Gemini API Key..." class="theme-input-field" title="在此輸入您的 Gemini API Key">
                <button id="saveApiKeyBtn" class="analyze-btn" title="啟用 Gemini AI 功能">
                    <i class="fas fa-check"></i>
                                        <span class="key-status-text">尚未啟用</span>
                </button>
            </div>
            <p id="apiStatusMsg" class="error-message" style="margin-top: 0.5rem; color: var(--primary-color);">請輸入 Key 以啟用 AI 解釋功能。</p>
        </div>

        <div class="input-and-prompt-panel card">
            
            <div class="input-section">
                <h2 class="card-title">📈 客戶特徵輸入 (10 項)</h2>
                <div id="inputForm" class="input-group">
                    <div class="input-field-container"><label>1. 信用分數 (600-850)</label><input type="number" id="input_CreditScore" data-feature-name="CreditScore" value="711.0" class="theme-input-field"></div>
                    <div class="input-field-container"><label>2. 年齡 (歲)</label><input type="number" id="input_Age" data-feature-name="Age" value="37.0" class="theme-input-field"></div>
                    <div class="input-field-container"><label>3. 服務年限 (年)</label><input type="number" id="input_Tenure" data-feature-name="Tenure" value="8.0" class="theme-input-field"></div>
                    <div class="input-field-container"><label>4. 餘額 ($)</label><input type="number" id="input_Balance" data-feature-name="Balance" value="117565.03" class="theme-input-field"></div>
                    <div class="input-field-container"><label>5. 產品數量 (1-4)</label><input type="number" id="input_NumOfProducts" data-feature-name="NumOfProducts" value="2.0" class="theme-input-field"></div>
                    <div class="input-field-container"><label>6. 持有信用卡 (0/1)</label><input type="number" id="input_HasCrCard" data-feature-name="HasCrCard" value="1.0" class="theme-input-field"></div>
                    <div class="input-field-container"><label>7. 活躍會員 (0/1)</label><input type="number" id="input_IsActiveMember" data-feature-name="IsActiveMember" value="0.0" class="theme-input-field"></div>
                    <div class="input-field-container"><label>8. 估計薪資 ($)</label><input type="number" id="input_EstimatedSalary" data-feature-name="EstimatedSalary" value="51112.8" class="theme-input-field"></div>
                    <div class="input-field-container"><label>9. 國家/地區 (0:法 1:西 2:德)</label><input type="number" id="input_Geography" data-feature-name="Geography" value="2" class="theme-input-field"></div>
                    <div class="input-field-container"><label>10. 性別 (0:男 1:女)</label><input type="number" id="input_Gender" data-feature-name="Gender" value="1" class="theme-input-field"></div>
                </div>
            </div>

            <hr class="card-divider">

            <div class="prompt-section">
                <h2 class="card-title">💬 AI 解釋/行動建議 指令</h2>
                <div class="input-field-container">
                    <label>請輸入您希望 AI 如何解釋預測結果：</label>
                    <textarea id="aiPrompt" 
                              rows="5" 
                              class="theme-input-field"
                              placeholder="例如: 假設我是客戶經理，請用專業且具體的語言，結合輸入參數解釋流失風險，並提供三個具體的維護行動建議。">
請作為一名資產管理顧問，根據客戶的流失機率和輸入特徵，提供一份專業的風險分析報告，包含：1. 風險評估等級。2. 主要風險點。3. 建議採取的客戶留存行動。請使用條列式呈現並且簡單扼要，約500個Tokens內。
</textarea>
                </div>
                
                                <div class="action-buttons-container">
                                        <button id="analyzeBtn" class="analyze-btn analyze-full" disabled>
                        <span>執行模型預測並取得 AI 解釋</span>
                    </button>
                    
                                        <button id="predictOnlyBtn" class="analyze-btn analyze-predict-only">
                        <i class="fas fa-chart-line"></i>
                        <span>僅執行模型預測</span>
                    </button>
                </div>
                <p id="errorMsg" class="error-message hidden"></p>
            </div>
        </div>

        <div class="explanation-panel card">
            <h2 class="card-title">💡 AI 解釋與行動建議</h2>
            <div id="explanationOutput" class="output-content">
                <p id="initialMessage" class="initial-message">請先在上方輸入並**啟用**您的 Gemini API Key，然後輸入參數和指令，才能執行分析。</p>
            </div>
        </div>

        <div class="chart-panel card">
            <h2 class="card-title">📊 模型內建輸出圖表顯示區</h2>
            <div id="chartDisplay" class="chart-display">
                <div class="chart-placeholder">圖表 1: **單一客戶局部 SHAP 影響力**</div>
                <div class="chart-placeholder">圖表 2: **模型全局 SHAP 摘要圖**</div>
                <div class="chart-placeholder">等待執行預測後顯示結果...</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/churn_bank.js') }}"></script>
{% endblock %}